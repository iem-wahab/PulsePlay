function t(r,c,p,y){return new(p||(p=Promise))((function(C,w){function o(r){try{h(y.next(r))}catch(r){w(r)}}function a(r){try{h(y.throw(r))}catch(r){w(r)}}function h(r){var c;r.done?C(r.value):(c=r.value,c instanceof p?c:new p((function(r){r(c)}))).then(o,a)}h((y=y.apply(r,c||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(){this.listeners={}}on(r,c,p){if(this.listeners[r]||(this.listeners[r]=new Set),this.listeners[r].add(c),null==p?void 0:p.once){const i=()=>{this.un(r,i),this.un(r,c)};return this.on(r,i),i}return()=>this.un(r,c)}un(r,c){var p;null===(p=this.listeners[r])||void 0===p||p.delete(c)}once(r,c){return this.on(r,c,{once:!0})}unAll(){this.listeners={}}emit(r,...c){this.listeners[r]&&this.listeners[r].forEach((r=>r(...c)))}}const r={decode:function(r,c){return t(this,void 0,void 0,(function*(){const p=new AudioContext({sampleRate:c});return p.decodeAudioData(r).finally((()=>p.close()))}))},createBuffer:function(r,c){return"number"==typeof r[0]&&(r=[r]),function(r){const c=r[0];if(c.some((r=>r>1||r<-1))){const p=c.length;let y=0;for(let r=0;r<p;r++){const p=Math.abs(c[r]);p>y&&(y=p)}for(const c of r)for(let r=0;r<p;r++)c[r]/=y}}(r),{duration:c,length:r[0].length,sampleRate:r[0].length/c,numberOfChannels:r.length,getChannelData:c=>null==r?void 0:r[c],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function s(r,c){const p=c.xmlns?document.createElementNS(c.xmlns,r):document.createElement(r);for(const[r,y]of Object.entries(c))if("children"===r)for(const[r,y]of Object.entries(c))"string"==typeof y?p.appendChild(document.createTextNode(y)):p.appendChild(s(r,y));else"style"===r?Object.assign(p.style,y):"textContent"===r?p.textContent=y:p.setAttribute(r,y.toString());return p}function n(r,c,p){const y=s(r,c||{});return null==p||p.appendChild(y),y}var c=Object.freeze({__proto__:null,createElement:n,default:n});const p={fetchBlob:function(r,c,p){return t(this,void 0,void 0,(function*(){const y=yield fetch(r,p);if(y.status>=400)throw new Error(`Failed to fetch ${r}: ${y.status} (${y.statusText})`);return function(r,c){t(this,void 0,void 0,(function*(){if(!r.body||!r.headers)return;const p=r.body.getReader(),y=Number(r.headers.get("Content-Length"))||0;let C=0;const o=r=>t(this,void 0,void 0,(function*(){C+=(null==r?void 0:r.length)||0;const p=Math.round(C/y*100);c(p)})),a=()=>t(this,void 0,void 0,(function*(){let r;try{r=yield p.read()}catch(r){return}r.done||(o(r.value),yield a())}));a()}))}(y.clone(),c),y.blob()}))}};class a extends e{constructor(r){super(),this.isExternalMedia=!1,r.media?(this.media=r.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),r.mediaControls&&(this.media.controls=!0),r.autoplay&&(this.media.autoplay=!0),null!=r.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=r.playbackRate&&(this.media.playbackRate=r.playbackRate)}),{once:!0})}onMediaEvent(r,c,p){return this.media.addEventListener(r,c,p),()=>this.media.removeEventListener(r,c,p)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const r=this.getSrc();r.startsWith("blob:")&&URL.revokeObjectURL(r)}canPlayType(r){return""!==this.media.canPlayType(r)}setSrc(r,c){const p=this.getSrc();if(r&&p===r)return;this.revokeSrc();const y=c instanceof Blob&&(this.canPlayType(c.type)||!r)?URL.createObjectURL(c):r;try{this.media.src=y}catch(c){this.media.src=r}}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(r){this.media=r}play(){return t(this,void 0,void 0,(function*(){return this.media.play()}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(r){this.media.currentTime=r}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(r){this.media.volume=r}getMuted(){return this.media.muted}setMuted(r){this.media.muted=r}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(r,c){null!=c&&(this.media.preservesPitch=c),this.media.playbackRate=r}getMediaElement(){return this.media}setSinkId(r){return this.media.setSinkId(r)}}class h extends e{constructor(r,c){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.subscriptions=[],this.options=r;const p=this.parentFromOptionsContainer(r.container);this.parent=p;const[y,C]=this.initHtml();p.appendChild(y),this.container=y,this.scrollContainer=C.querySelector(".scroll"),this.wrapper=C.querySelector(".wrapper"),this.canvasWrapper=C.querySelector(".canvases"),this.progressWrapper=C.querySelector(".progress"),this.cursor=C.querySelector(".cursor"),c&&C.appendChild(c),this.initEvents()}parentFromOptionsContainer(r){let c;if("string"==typeof r?c=document.querySelector(r):r instanceof HTMLElement&&(c=r),!c)throw new Error("Container not found");return c}initEvents(){const t=r=>{const c=this.wrapper.getBoundingClientRect(),p=r.clientX-c.left,y=r.clientY-c.top;return[p/c.width,y/c.height]};if(this.wrapper.addEventListener("click",(r=>{const[c,p]=t(r);this.emit("click",c,p)})),this.wrapper.addEventListener("dblclick",(r=>{const[c,p]=t(r);this.emit("dblclick",c,p)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:r,scrollWidth:c,clientWidth:p}=this.scrollContainer,y=r/c,C=(r+p)/c;this.emit("scroll",y,C,r,r+p)})),"function"==typeof ResizeObserver){const r=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{r().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const r=this.parent.clientWidth;r===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=r,this.reRender())}initDrag(){this.subscriptions.push(function(r,c,p,y,C=3,w=0,S=100){if(!r)return()=>{};const E=matchMedia("(pointer: coarse)").matches;let h=()=>{};const l=M=>{if(M.button!==w)return;M.preventDefault(),M.stopPropagation();let x=M.clientX,k=M.clientY,P=!1;const T=Date.now(),m=y=>{if(y.preventDefault(),y.stopPropagation(),E&&Date.now()-T<S)return;const w=y.clientX,M=y.clientY,D=w-x,R=M-k;if(P||Math.abs(D)>C||Math.abs(R)>C){const y=r.getBoundingClientRect(),{left:C,top:S}=y;P||(null==p||p(x-C,k-S),P=!0),c(D,R,w-C,M-S),x=w,k=M}},g=c=>{if(P){const p=c.clientX,C=c.clientY,w=r.getBoundingClientRect(),{left:S,top:E}=w;null==y||y(p-S,C-E)}h()},f=r=>{r.relatedTarget&&r.relatedTarget!==document.documentElement||g(r)},v=r=>{P&&(r.stopPropagation(),r.preventDefault())},b=r=>{P&&r.preventDefault()};document.addEventListener("pointermove",m),document.addEventListener("pointerup",g),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),h=()=>{document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",g),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return r.addEventListener("pointerdown",l),()=>{h(),r.removeEventListener("pointerdown",l)}}(this.wrapper,((r,c,p)=>{this.emit("drag",Math.max(0,Math.min(1,p/this.wrapper.getBoundingClientRect().width)))}),(r=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))}),(r=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))})))}getHeight(r,c){var p;const y=(null===(p=this.audioData)||void 0===p?void 0:p.numberOfChannels)||1;if(null==r)return 128;if(!isNaN(Number(r)))return Number(r);if("auto"===r){const r=this.parent.clientHeight||128;return(null==c?void 0:c.every((r=>!r.overlay)))?r/y:r}return 128}initHtml(){const r=document.createElement("div"),c=r.attachShadow({mode:"open"}),p=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return c.innerHTML=`\n      <style${p?` nonce="${p}"`:""}>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[r,c]}setOptions(r){if(this.options.container!==r.container){const c=this.parentFromOptionsContainer(r.container);c.appendChild(this.container),this.parent=c}!0!==r.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=r,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(r){this.scrollContainer.scrollLeft=r}setScrollPercentage(r){const{scrollWidth:c}=this.scrollContainer,p=c*r;this.setScroll(p)}destroy(){var r,c;this.subscriptions.forEach((r=>r())),this.container.remove(),null===(r=this.resizeObserver)||void 0===r||r.disconnect(),null===(c=this.unsubscribeOnScroll)||void 0===c||c.call(this)}createDelay(r=10){let c,p;const s=()=>{c&&clearTimeout(c),p&&p()};return this.timeouts.push(s),()=>new Promise(((y,C)=>{s(),p=C,c=setTimeout((()=>{c=void 0,p=void 0,y()}),r)}))}convertColorValues(r){if(!Array.isArray(r))return r||"";if(r.length<2)return r[0]||"";const c=document.createElement("canvas"),p=c.getContext("2d"),y=c.height*(window.devicePixelRatio||1),C=p.createLinearGradient(0,0,0,y),w=1/(r.length-1);return r.forEach(((r,c)=>{const p=c*w;C.addColorStop(p,r)})),C}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(r,c,p,y){const C=r[0],w=r[1]||r[0],S=C.length,{width:E,height:M}=p.canvas,x=M/2,k=this.getPixelRatio(),P=c.barWidth?c.barWidth*k:1,T=c.barGap?c.barGap*k:c.barWidth?P/2:0,D=c.barRadius||0,R=E/(P+T)/S,L=D&&"roundRect"in p?"roundRect":"rect";p.beginPath();let W=0,O=0,N=0;for(let r=0;r<=S;r++){const S=Math.round(r*R);if(S>W){const r=Math.round(O*x*y),C=r+Math.round(N*x*y)||1;let w=x-r;"top"===c.barAlign?w=0:"bottom"===c.barAlign&&(w=M-C),p[L](W*(P+T),w,P,C,D),W=S,O=0,N=0}const E=Math.abs(C[r]||0),k=Math.abs(w[r]||0);E>O&&(O=E),k>N&&(N=k)}p.fill(),p.closePath()}renderLineWaveform(r,c,p,y){const n=c=>{const C=r[c]||r[0],w=C.length,{height:S}=p.canvas,E=S/2,M=p.canvas.width/w;p.moveTo(0,E);let x=0,k=0;for(let r=0;r<=w;r++){const w=Math.round(r*M);if(w>x){const r=E+(Math.round(k*E*y)||1)*(0===c?-1:1);p.lineTo(x,r),x=w,k=0}const S=Math.abs(C[r]||0);S>k&&(k=S)}p.lineTo(x,E)};p.beginPath(),n(0),n(1),p.fill(),p.closePath()}renderWaveform(r,c,p){if(p.fillStyle=this.convertColorValues(c.waveColor),c.renderFunction)return void c.renderFunction(r,p);let y=c.barHeight||1;if(c.normalize){const c=Array.from(r[0]).reduce(((r,c)=>Math.max(r,Math.abs(c))),0);y=c?1/c:1}c.barWidth||c.barGap||c.barAlign?this.renderBarWaveform(r,c,p,y):this.renderLineWaveform(r,c,p,y)}renderSingleCanvas(r,c,p,y,C,w,S){const E=this.getPixelRatio(),M=document.createElement("canvas");M.width=Math.round(p*E),M.height=Math.round(y*E),M.style.width=`${p}px`,M.style.height=`${y}px`,M.style.left=`${Math.round(C)}px`,w.appendChild(M);const x=M.getContext("2d");if(this.renderWaveform(r,c,x),M.width>0&&M.height>0){const r=M.cloneNode(),p=r.getContext("2d");p.drawImage(M,0,0),p.globalCompositeOperation="source-in",p.fillStyle=this.convertColorValues(c.progressColor),p.fillRect(0,0,M.width,M.height),S.appendChild(r)}}renderMultiCanvas(r,c,p,y,C,w){const S=this.getPixelRatio(),{clientWidth:E}=this.scrollContainer,M=p/S;let x=Math.min(h.MAX_CANVAS_WIDTH,E,M),k={};if(c.barWidth||c.barGap){const r=c.barWidth||.5,p=r+(c.barGap||r/2);x%p!=0&&(x=Math.floor(x/p)*p)}const u=p=>{if(p<0||p>=P)return;if(k[p])return;k[p]=!0;const S=p*x,E=Math.min(M-S,x);if(E<=0)return;const T=r.map((r=>{const c=Math.floor(S/M*r.length),p=Math.floor((S+E)/M*r.length);return r.slice(c,p)}));this.renderSingleCanvas(T,c,E,y,S,C,w)},P=Math.ceil(M/x);if(!this.isScrollable){for(let r=0;r<P;r++)u(r);return}const T=this.scrollContainer.scrollLeft/M,D=Math.floor(T*P);u(D-1),u(D),u(D+1),P>1&&(this.unsubscribeOnScroll=this.on("scroll",(()=>{const{scrollLeft:r}=this.scrollContainer,c=Math.floor(r/M*P);Object.keys(k).length>h.MAX_NODES&&(C.innerHTML="",w.innerHTML="",k={}),u(c-1),u(c),u(c+1)})))}renderChannel(r,c,p,y){var{overlay:C}=c,w=function(r,c){var p={};for(var y in r)Object.prototype.hasOwnProperty.call(r,y)&&c.indexOf(y)<0&&(p[y]=r[y]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols){var C=0;for(y=Object.getOwnPropertySymbols(r);C<y.length;C++)c.indexOf(y[C])<0&&Object.prototype.propertyIsEnumerable.call(r,y[C])&&(p[y[C]]=r[y[C]])}return p}(c,["overlay"]);const S=document.createElement("div"),E=this.getHeight(w.height,w.splitChannels);S.style.height=`${E}px`,C&&y>0&&(S.style.marginTop=`-${E}px`),this.canvasWrapper.style.minHeight=`${E}px`,this.canvasWrapper.appendChild(S);const M=S.cloneNode();this.progressWrapper.appendChild(M),this.renderMultiCanvas(r,w,p,E,S,M)}render(r){return t(this,void 0,void 0,(function*(){var c;this.timeouts.forEach((r=>r())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const p=this.getPixelRatio(),y=this.scrollContainer.clientWidth,C=Math.ceil(r.duration*(this.options.minPxPerSec||0));this.isScrollable=C>y;const w=this.options.fillParent&&!this.isScrollable,S=(w?y:C)*p;if(this.wrapper.style.width=w?"100%":`${C}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=r,this.emit("render"),this.options.splitChannels)for(let p=0;p<r.numberOfChannels;p++){const y=Object.assign(Object.assign({},this.options),null===(c=this.options.splitChannels)||void 0===c?void 0:c[p]);this.renderChannel([r.getChannelData(p)],y,S,p)}else{const c=[r.getChannelData(0)];r.numberOfChannels>1&&c.push(r.getChannelData(1)),this.renderChannel(c,this.options,S,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){var r;if(null===(r=this.unsubscribeOnScroll)||void 0===r||r.call(this),delete this.unsubscribeOnScroll,!this.audioData)return;const{scrollWidth:c}=this.scrollContainer,{right:p}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&c!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let c=r-p;c*=2,c=c<0?Math.floor(c):Math.ceil(c),c/=2,this.scrollContainer.scrollLeft+=c}}zoom(r){this.options.minPxPerSec=r,this.reRender()}scrollIntoView(r,c=!1){const{scrollLeft:p,scrollWidth:y,clientWidth:C}=this.scrollContainer,w=r*y,S=p,E=p+C,M=C/2;if(this.isDragging){const r=30;w+r>E?this.scrollContainer.scrollLeft+=r:w-r<S&&(this.scrollContainer.scrollLeft-=r)}else{(w<S||w>E)&&(this.scrollContainer.scrollLeft=w-(this.options.autoCenter?M:0));const r=w-p-M;c&&this.options.autoCenter&&r>0&&(this.scrollContainer.scrollLeft+=Math.min(r,10))}{const r=this.scrollContainer.scrollLeft,c=r/y,p=(r+C)/y;this.emit("scroll",c,p,r,r+C)}}renderProgress(r,c){if(isNaN(r))return;const p=100*r;this.canvasWrapper.style.clipPath=`polygon(${p}% 0, 100% 0, 100% 100%, ${p}% 100%)`,this.progressWrapper.style.width=`${p}%`,this.cursor.style.left=`${p}%`,this.cursor.style.transform=`translateX(-${100===Math.round(p)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(r,c)}exportImage(r,c,p){return t(this,void 0,void 0,(function*(){const y=this.canvasWrapper.querySelectorAll("canvas");if(!y.length)throw new Error("No waveform data");if("dataURL"===p){const p=Array.from(y).map((p=>p.toDataURL(r,c)));return Promise.resolve(p)}return Promise.all(Array.from(y).map((p=>new Promise(((y,C)=>{p.toBlob((r=>{r?y(r):C(new Error("Could not export image"))}),r,c)})))))}))}}h.MAX_CANVAS_WIDTH=8e3,h.MAX_NODES=10;class l extends e{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class d extends e{constructor(r=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=r,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return t(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(r){if(this.currentSrc=r,this._duration=void 0,!r)return this.buffer=null,void this.emit("emptied");fetch(r).then((c=>{if(c.status>=400)throw new Error(`Failed to fetch ${r}: ${c.status} (${c.statusText})`);return c.arrayBuffer()})).then((c=>this.currentSrc!==r?null:this.audioContext.decodeAudioData(c))).then((c=>{this.currentSrc===r&&(this.buffer=c,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var r;if(!this.paused)return;this.paused=!1,null===(r=this.bufferNode)||void 0===r||r.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let c=this.playedDuration*this._playbackRate;c>=this.duration&&(c=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,c),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var r;this.paused=!0,null===(r=this.bufferNode)||void 0===r||r.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(r){var c,p;const y=r-this.currentTime;null===(c=this.bufferNode)||void 0===c||c.stop(this.audioContext.currentTime+y),null===(p=this.bufferNode)||void 0===p||p.addEventListener("ended",(()=>{this.bufferNode=null,this.pause()}),{once:!0})}setSinkId(r){return t(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(r)}))}get playbackRate(){return this._playbackRate}set playbackRate(r){this._playbackRate=r,this.bufferNode&&(this.bufferNode.playbackRate.value=r)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(r){const c=!this.paused;c&&this._pause(),this.playedDuration=r/this._playbackRate,c&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var r,c;return null!==(r=this._duration)&&void 0!==r?r:(null===(c=this.buffer)||void 0===c?void 0:c.duration)||0}set duration(r){this._duration=r}get volume(){return this.gainNode.gain.value}set volume(r){this.gainNode.gain.value=r,this.emit("volumechange")}get muted(){return this._muted}set muted(r){this._muted!==r&&(this._muted=r,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(r){return/^(audio|video)\//.test(r)}getGainNode(){return this.gainNode}getChannelData(){const r=[];if(!this.buffer)return r;const c=this.buffer.numberOfChannels;for(let p=0;p<c;p++)r.push(this.buffer.getChannelData(p));return r}}const y={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class u extends a{static create(r){return new u(r)}constructor(r){const c=r.media||("WebAudio"===r.backend?new d:void 0);super({media:c,mediaControls:r.mediaControls,autoplay:r.autoplay,playbackRate:r.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},y,r),this.timer=new l;const p=c?void 0:this.getMediaElement();this.renderer=new h(this.options,p),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const C=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:r,duration:c}=this.options;(C||r&&c)&&this.load(C,r,c).catch((()=>null))}))}updateProgress(r=this.getCurrentTime()){return this.renderer.renderProgress(r/this.getDuration(),this.isPlaying()),r}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const r=this.updateProgress();this.emit("timeupdate",r),this.emit("audioprocess",r)}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const r=this.updateProgress();this.emit("timeupdate",r)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop()})),this.onMediaEvent("emptied",(()=>{this.timer.stop()})),this.onMediaEvent("ended",(()=>{this.emit("finish")})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(r=>{this.emit("error",r.error)})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((r,c)=>{this.options.interact&&(this.seekTo(r),this.emit("interaction",r*this.getDuration()),this.emit("click",r,c))})),this.renderer.on("dblclick",((r,c)=>{this.emit("dblclick",r,c)})),this.renderer.on("scroll",((r,c,p,y)=>{const C=this.getDuration();this.emit("scroll",r*C,c*C,p,y)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(r=>{this.emit("dragstart",r)})),this.renderer.on("dragend",(r=>{this.emit("dragend",r)})));{let r;this.subscriptions.push(this.renderer.on("drag",(c=>{if(!this.options.interact)return;let p;this.renderer.renderProgress(c),clearTimeout(r),this.isPlaying()?p=0:!0===this.options.dragToSeek?p=200:"object"==typeof this.options.dragToSeek&&void 0!==this.options.dragToSeek&&(p=this.options.dragToSeek.debounceTime),r=setTimeout((()=>{this.seekTo(c)}),p),this.emit("interaction",c*this.getDuration()),this.emit("drag",c)})))}}initPlugins(){var r;(null===(r=this.options.plugins)||void 0===r?void 0:r.length)&&this.options.plugins.forEach((r=>{this.registerPlugin(r)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((r=>r())),this.mediaSubscriptions=[]}setOptions(r){this.options=Object.assign({},this.options,r),this.renderer.setOptions(this.options),r.audioRate&&this.setPlaybackRate(r.audioRate),null!=r.mediaControls&&(this.getMediaElement().controls=r.mediaControls)}registerPlugin(r){return r._init(this),this.plugins.push(r),this.subscriptions.push(r.once("destroy",(()=>{this.plugins=this.plugins.filter((c=>c!==r))}))),r}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(r){return this.renderer.setScroll(r)}setScrollTime(r){const c=r/this.getDuration();this.renderer.setScrollPercentage(c)}getActivePlugins(){return this.plugins}loadAudio(c,y,C,w){return t(this,void 0,void 0,(function*(){var S;if(this.emit("load",c),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!y&&!C){const r=this.options.fetchParams||{};window.AbortController&&!r.signal&&(this.abortController=new AbortController,r.signal=null===(S=this.abortController)||void 0===S?void 0:S.signal);const n=r=>this.emit("loading",r);y=yield p.fetchBlob(c,n,r)}this.setSrc(c,y);const E=yield new Promise((r=>{const c=w||this.getDuration();c?r(c):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>r(this.getDuration())),{once:!0}))}));if(!c&&!y){const r=this.getMediaElement();r instanceof d&&(r.duration=E)}if(C)this.decodedData=r.createBuffer(C,E||0);else if(y){const c=yield y.arrayBuffer();this.decodedData=yield r.decode(c,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(r,c,p){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio(r,void 0,c,p)}catch(r){throw this.emit("error",r),r}}))}loadBlob(r,c,p){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",r,c,p)}catch(r){throw this.emit("error",r),r}}))}zoom(r){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(r),this.emit("zoom",r)}getDecodedData(){return this.decodedData}exportPeaks({channels:r=2,maxLength:c=8e3,precision:p=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const y=Math.min(r,this.decodedData.numberOfChannels),C=[];for(let r=0;r<y;r++){const y=this.decodedData.getChannelData(r),w=[],S=y.length/c;for(let r=0;r<c;r++){const c=y.slice(Math.floor(r*S),Math.ceil((r+1)*S));let C=0;for(let r=0;r<c.length;r++){const p=c[r];Math.abs(p)>Math.abs(C)&&(C=p)}w.push(Math.round(C*p)/p)}C.push(w)}return C}getDuration(){let r=super.getDuration()||0;return 0!==r&&r!==1/0||!this.decodedData||(r=this.decodedData.duration),r}toggleInteraction(r){this.options.interact=r}setTime(r){super.setTime(r),this.updateProgress(r),this.emit("timeupdate",r)}seekTo(r){const c=this.getDuration()*r;this.setTime(c)}playPause(){return t(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(r){this.setTime(this.getCurrentTime()+r)}empty(){this.load("",[[0]],.001)}setMediaElement(r){this.unsubscribePlayerEvents(),super.setMediaElement(r),this.initPlayerEvents()}exportImage(){return t(this,arguments,void 0,(function*(r="image/png",c=1,p="dataURL"){return this.renderer.exportImage(r,c,p)}))}destroy(){var r;this.emit("destroy"),null===(r=this.abortController)||void 0===r||r.abort(),this.plugins.forEach((r=>r.destroy())),this.subscriptions.forEach((r=>r())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}u.BasePlugin=class extends e{constructor(r){super(),this.subscriptions=[],this.options=r}onInit(){}_init(r){this.wavesurfer=r,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((r=>r()))}},u.dom=c;export{u as default};

